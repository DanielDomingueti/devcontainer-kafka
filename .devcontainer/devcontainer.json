{
	"name": "Custom Python 3 - Devcontainer + Kafka",
	// Usar uma Dockerfile personalizada que estenda a imagem oficial do Python
	"image": "mcr.microsoft.com/devcontainers/python:1-3.11-bullseye",
	"build": {
		"dockerfile": "Dockerfile"
	},

	"features": {
		"ghcr.io/devcontainers/features/docker-in-docker:1": {
			"version": "latest",
			"moby": true
		}
	},
	// Redirecionar a porta 9092 do Kafka para que você possa acessá-lo do host
	"forwardPorts": [9092],

	// Comandos a serem executados após a criação do contêiner
	"postCreateCommand": "docker-compose up -d",

	// Configurações específicas do ambiente do Kafka
	"customizations": {
		"environment": {
			"KAFKA_ADVERTISED_LISTENERS": "INSIDE://kafka:9092,OUTSIDE://localhost:9092",
			"KAFKA_LISTENER_SECURITY_PROTOCOL_MAP": "INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT",
			"KAFKA_LISTENERS": "INSIDE://localhost:9092,OUTSIDE://localhost:9092",
			"KAFKA_INTER_BROKER_LISTENER_NAME": "INSIDE",
			"KAFKA_ZOOKEEPER_CONNECT": "zookeeper:2181"
		}
	},

	// Importante para garantir que o contêiner seja executado como usuário não-root
	"remoteUser": "vscode"
}
